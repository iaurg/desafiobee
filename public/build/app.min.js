!function(){"use strict";angular.module("DesafioBee",["ui.router","restangular","satellizer","toaster","ngAnimate","focusIt","jcs-autoValidate","static-include","btford.socket-io","luegg.directives"])}(),function(){"use strict";angular.module("DesafioBee").run(["defaultErrorMessageResolver",function(defaultErrorMessageResolver){defaultErrorMessageResolver.setI18nFileRootPath("libs/angular-auto-validate/src/lang"),defaultErrorMessageResolver.setCulture("pt-br")}]).config(["$authProvider",function($authProvider){$authProvider.loginUrl="/api/authenticate"}]).run(["$rootScope","$state","$http",function($rootScope,$state,$http){var token=localStorage.getItem("satellizer_token");token&&$http({method:"GET",url:"/api/authenticate/user",headers:{"x-access-token":token}}).then(function(response){var user=JSON.stringify(response.data.user);localStorage.setItem("user",user),$rootScope.currentUser=response.data.user,$state.go("app.index")},function(){event.preventDefault(),localStorage.removeItem("user"),localStorage.removeItem("satellizer_token"),$rootScope.currentUser=null,$state.go("signin")})}]).run(["$rootScope","$state",function($rootScope,$state){$rootScope.$on("$stateChangeStart",function(event,next){var token=localStorage.getItem("satellizer_token");!token&&next.name.includes("app")&&(event.preventDefault(),$state.go("signin"))})}]).config(["RestangularProvider",function(RestangularProvider){RestangularProvider.setBaseUrl("/api")}]).run(["Restangular","$http","$state","$rootScope",function(Restangular,$http,$state,$rootScope){Restangular.setErrorInterceptor(function(response){return 403===response.status?(localStorage.removeItem("user"),localStorage.removeItem("satellizer_token"),$rootScope.currentUser=null,$state.go("signin"),!1):!0})}])}(),function(){"use strict";angular.module("DesafioBee").config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider){$urlRouterProvider.otherwise("/signin"),$stateProvider.state("signin",{url:"/signin",templateUrl:"views/signin.html",controller:"SignInController as SignIn"}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignUpController as SignUp"}).state("app",{url:"/app",templateUrl:"views/extend.html",controller:"AppController as App"}).state("app.index",{url:"/index",templateUrl:"views/app/index.html",controller:"IndexController as Index"}),$locationProvider.html5Mode(!0)}])}(),function(){"use strict";angular.module("DesafioBee").controller("AppController",["$state","$rootScope","$auth",function($state,$rootScope,$auth){var vm=this;vm.logout=function(){$auth.logout().then(function(){localStorage.removeItem("user"),$rootScope.authenticated=!1,$rootScope.currentUser=null,$state.go("signin")})}}])}(),function(){"use strict";angular.module("DesafioBee").controller("ChannelController",["Restangular","toaster","socket","$rootScope",function(Restangular,toaster,socket,$rootScope){var vm=this;socket.on("channel",function(channel){vm.channels.push(channel)}),socket.on("message",function(message){null!==$rootScope.selectedChannel&&message.ChannelId===$rootScope.selectedChannel.id||angular.forEach(vm.channels,function(channel){channel.id===message.ChannelId&&(channel.newMessage=!0)})}),vm.load=function(){vm.loading=!0,Restangular.all("/channels").getList().then(function(response){vm.channels=response,vm.loading=!1})},vm.load(),vm.submit=function(){Restangular.one("/channels").customPOST(vm.newChannel).then(function(){vm.formChannel.$setPristine(),vm.newChannel={}},function(response){response.data.error===!0&&toaster.pop("error","Ops!",response.data.message)})}}])}(),function(){"use strict";angular.module("DesafioBee").controller("IndexController",["Restangular","$rootScope","focus","socket",function(Restangular,$rootScope,focus,socket){var vm=this;$rootScope.selectedChannel=null,vm.newMessage={userId:$rootScope.currentUser.id},socket.on("message",function(message){null!==$rootScope.selectedChannel&&message.ChannelId===$rootScope.selectedChannel.id&&vm.messages.push(message)}),vm.selectChannel=function(channel){channel.newMessage=!1,vm.newMessage.channelId=channel.id,$rootScope.selectedChannel=channel,focus("message"),vm.load()},vm.sendMessage=function(){Restangular.one("/messages").customPOST(vm.newMessage).then(function(){vm.newMessage.message="",vm.formNewMessage.$setPristine()})},vm.load=function(){vm.loadingMessages=!0,Restangular.one("channels",$rootScope.selectedChannel.id).customGETLIST("messages").then(function(response){vm.loadingMessages=!1,vm.messages=response})}}])}(),function(){"use strict";angular.module("DesafioBee").controller("SignInController",["$state","$auth","$rootScope","toaster","focus",function($state,$auth,$rootScope,toaster,focus){var vm=this;vm.loginData={},vm.loginData.username=localStorage.getItem("lastUser"),focus(vm.loginData.username?"password":"username"),vm.login=function(){localStorage.setItem("lastUser",vm.loginData.username),$auth.login(vm.loginData).then(function(response){if(response.data.success===!0){var user=JSON.stringify(response.data.user);localStorage.setItem("user",user),$rootScope.currentUser=response.data.user,$state.go("app.index")}else toaster.pop("error","Ops!",response.data.message)})}}])}(),function(){"use strict";angular.module("DesafioBee").controller("SignUpController",["Restangular","focus","$state","toaster",function(Restangular,focus,$state,toaster){var vm=this;focus("name"),vm.signup=function(){Restangular.one("/users").customPOST(vm.userData).then(function(){localStorage.setItem("lastUser",vm.userData.username),vm.userData={},$state.go("signnin")},function(response){response.data.error===!0&&toaster.pop("error","Ops!",response.data.message)})}}])}(),function(){"use strict";angular.module("DesafioBee").factory("socket",["socketFactory",function(socketFactory){var myIoSocket=io.connect("http://localhost:8080"),socket=socketFactory({ioSocket:myIoSocket});return socket}])}();